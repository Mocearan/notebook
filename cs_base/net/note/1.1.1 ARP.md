# ARP

---

​		ARP协议实现任意网络层地址到任意物理地址的转换，一般是从IP地址到以太网地址（MAC地址）的转换。

​		工作原理是：

- 主机向自己所在的网络广播一个ARP请求，请求包含目标机器的网络地址
- 网络上的其他机器都将收到这个请求，但只有被其你去的目标机器会回应一个ARP应答，其中包含自己的物理地址

![image-20230422210517303](https://raw.githubusercontent.com/Mocearan/picgo-server/main/image-20230422210517303.png)

- 硬件类型：定义物理地址的类型
  - `1`，MAC地址
- 协议类型：表示要映射的协议地址类型
  - `0x800`，IP地址
- 硬件地址长度：MAC地址长度为6，单位字节
- 协议地址长度：IP地址长度为4，单位字节
- 操作字段：
  - `1`，ARP请求
  - `2`，ARP应答
  - `3`，RARP请求
  - `4`，RARP应答
- 其余四个字段指定通信双方以太网地址和IP地址
  - 发送端填充除目的端以太网地址外的其他三个字段，构建ARP请求
  - 接收端填充自己的以太网地址，交换目的端和发送端的两个地址，修改操作字段为`2`，构建ARP应答

​		ARP报文长度为28字节，加上以太网帧头部和尾部18字节，共46字节。部分实现要求至少46字节，则需要增加填充字节，达到64字节。



## ARP高速缓存

​		ARP维护一个高速缓存，其中包含经常访问或最近访问的机器IP地址到物理地址的映射（如网关地址），避免重复的ARP请求，提高发送数据包的速度。

```shell
# 查看ARP缓存
[root@VM-4-7-centos ~]# arp -a
gateway (10.0.4.1) at fe:ee:8f:bf:86:99 [ether] on eth0 # 网关地址
? (169.254.128.2) at fe:ee:8f:bf:86:99 [ether] on eth0

# 删除ARP缓存
[root@VM-4-7-centos ~]# arp -d 169.254.0.83

# 添加ARP缓存
[root@VM-4-7-centos ~]# arp -s 169.254.0.83 fe:ee:8f:bf:86:99
```



## 