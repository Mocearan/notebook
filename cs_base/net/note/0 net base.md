

![image-20230420210735463](https://raw.githubusercontent.com/Mocearan/picgo-server/main/image-20230420210735463.png)



# 基础知识

---

## 网络的发展

- 现代互联网起源于阿帕网（ARPA NET），使用网络控制协议（NCP，Network Control Protocol）在不同计算机之间中进行通信。
- NCP的作者于1974年开发下一代网络互连协议，以分组、序列化、流量控制、超时和容错等为核心，是TCP/IP协议的基础。
- ISO标准化组织发布OSI参考模型，极为精巧的构筑了七层网络协议栈模型，但理论价值大于实用价值。
- TCP/IP 在NCP作者的大力推广下，借UNIX操作系统发展的快车，推出基于socket套接字的实际编程接口。
- 后来网络时代，大量互联网网络应用构筑在TCP/IP 协议栈之上。

​		

## 网络分层模型

### ISO/OSI七层模型

​		OSI（open system interconnection） 开放系统互联模型，是由ISO国际标准化组织定义的网络分层模型，共七层。

1. 物理层， 由物理层协议支持，进行比特流传输，传输单位bit

1. 数据链路层，有数据链路层协议支持，提供介质访问、链路管理功能，传输单位是帧（frame）
2. 网络层，由网络层协议支持，提供端点寻址、路由选择功能，传输单位是包（packet，也成分组）
3. 传输层，由传输层协议支持，建立端到端的连接，传输单位是段（segment）
4. 会话层，由会话层协议支持，建立、维护、管理会话，传输单位是session pdu(spdu)
5. 表示层，由表示层协议支持，处理数据格式、数据加密等，传输单位是 presentation pdu（ppdu)
6. 应用层，有应用层协议支持，提供应用程序间通信，传输单位是application pdu（apdu）

> 每个对等层的传输单位统称为PDU（protocol data unit，协议数据单元）， 

#### 物理层

​		Physical Layer，定义了所有电子及物理设备的规范，为上层的传输提供了一个物理介质，本层中数据传输的单位是比特(b)。

​		本层定义的规范有：EIA/TIA RS-232、EIA/TIA RS-449串口协议，RJ-45网络接口协议（水晶头）等，实际使用中的设备有网卡等。

​		本层传输的比特流，仅仅是以信号表示的二进制位串，不经解释前只是一串信号表示。

#### 数据链路层 

​		Data Link Layer，对物理层收到的比特流进行数据成帧（frame），即对物理层传递的数据加上一定的格式，通过这些格式，可以提供可靠的数据传输服务、实现无差错数据传输的功能。

​		本层定义的规范有：SDLC、HDLC、PPP、STP，实际使用中的设备有switch交换机等。

#### 网络层

​		Network Layer，网络层负责将各个子网之间的数据进行路由选择，分组与重组。传输单位为数据包（packet）。

​		本层定义IDE规范有：IP、IPX、RIP、OSPF、ICMP、IGMP等协议，实际使用中的设备有路由器等。

#### 传输层

​		Transport Layer，提供可靠的数据传输服务，它检测路由器丢弃的包，然后产生一个重传请求，能够将乱序收到的数据包重新排序。 

#### 会话层

​		Session Layer，管理主机之间会话过程，包括会话建立、终止和会话过程中的状态管理。

#### 表示层

​		Presentation Layer，  对网络传输的数据进行变换，使得多个主机之间传递的信息能够互相理解，包括数据的压缩、加密、格式转换等。

#### 应用层

​		Application Layer， 应用层与应用程序界面沟通，已达到完成用户定义的目的。常见的协议有：HTTP、HTTPS、FTP、TELNET、SSH、SMTP、POP3及各种自定义私有协议等。 

> ​		虽然 ISO/OSI  参考模型没有实际使用的编码空间，但是在谈论理论的时候，人们依旧依照OSI参考模型来认知计算机网络，并且在相当一部分逻辑结构清晰的网络应用程序或框架中，人们都有意识的遵从或实现了会话层，表示层和应用层的分层结构。只不过理论上都视为TCP/IP四层模型的应用层。

### TCP/IP四层模型

​		由于七层模型设计过于精致，许多情况下实践起来比较困难。在具体的实践过程中，逐渐由TCP/IP所简化的四层模型占领了市场。

1. 链路层，也成为了接口层或网络访问层。提供设备上的网络接口规范和数据成帧服务。
2. 网络层， 与OSI网络层一致。
3. 传输层，与OSI传输层一致。
4. 应用层，提高应用层设计的灵活性。

> ​		但需要注意的是，如今大多数商用程序在应用层上，仍然需要手工的维护连接会话（许多网络框架已经包括），进行数据格式的处理（表示层的工作），实际所说的业务分层，即OSI的应用层。



#### 链路层

​		负责在以太网、WiFi这样的底层网络上发送原始数据包，工作在网卡这个层次，使用 MAC 地址来标记网络上的设备，有时候也叫MAC层。

​		ARP协议和RARP协议。

#### 网络层

​		定义了IP地址概念，可以在链路层的基础上，用IP地址取代MAC地址，把许许多多的局域网、广域网连接成一个虚拟的巨大网络，在这个网络里寻找主机，只要把IP地址再翻译成MAC地址就考科一了。

​		IP协议。

#### 传输层

​		保证数据在IP地址标记的两端之间传输数据。

​		有TCP和UDP。

#### 应用层

​		用户进行自定义协议进行网络数据交换。 

### 七层模型和四层模型的对比

![img](https://static001.geekbang.org/resource/image/9d/94/9d9b3c9274465c94e223676b6d434194.png)

> ​		OSI 的分层模型在四层以上分的太细，而 TCP/IP 实际应用时的会话管理、编码转换、压缩等和具体应用经常联系的很紧密，很难分开。



## 基本概念

### 对等通信

​		处于网络分层模型上相应层次的一端，只有在对端对等的层次上才能得到该层次可以正确处理的数据，称为对等通信。

### 封装

​		网络分层模型上相应的层次，会对由其上层传来的数据打上该层的头部，称为封装。有些层具有尾部

![image-20230420220830469](https://raw.githubusercontent.com/Mocearan/picgo-server/main/image-20230420220830469.png)

### 分用 Demultiplexing

​		网络分层模型上相应的层次，会对由其下层传来的数据解除该层的头部，分配给对应的协议栈处理，称为分用。

​		![image-20210901232042925](https://gitee.com/masstsing/picgo-picserver/raw/master/image-20210901232042925.png)

### IP地址

​		IP是网络上标识一台主机的地址编号。通常以点分十进制串表示， 实际上是一个32位二进制数字。

```
192..168.1.123
```

#### 网段与主机

​		IP地址的前若干位表示一个子网， 剩余位表示该子网中的主机。

​		子网具有分类，不同的分类网段与主机所占用的位数比例不同，能够在一个网段中表示的 主机数量不同。

![img](https://gitee.com/masstsing/picgo-picserver/raw/master/8062576bcd515e1c84cec960e4796fef.png)

#### 子网掩码

​		子网掩码也是一个点分十进制串表示32位二进制数字，通过和IP地址进行位与，以其中二进制1的位数，决定网段和主机的位数。

​		子网掩码前部连续若干个1表示网段位数，后部连续若干个0表示主机位数。

​		后来人们通过在IP地址后加 `/number`的方式来即表示网段的位数：`192.168.1.12/30`，表示网段有30位，主机2位，子网可以容纳4台主机：`00/01/10/11`

#### 保留网段

​		国际标准组织在IPv4地址空间中，画出一些网段，不会用作公网IP，仅仅保留作为局域网内部使用，这些地址称为保留网段。

#### 网卡

​		同一计算机中可以分配多个IP地址，实际IP地址的个数与计算机中安装的网卡（NIC）数量相等。即单机多网卡，每个网卡都分配有一个IP地址。



### 域名

​		域名是文字化的，易于记忆和表达的IP标记。通过将域名与IP进行映射，就可以通过域名来访问特定的服务器，并由此可以进行应用层的路由、负载均衡等。

#### DNS

​		DNS(Domain Name Systrem)， 域名系统。DNS是对IP地址和域名进行相互转换的系统，核心是DNS服务器。

​		在网络之间路由数据包还是需要通过IP地址来进行寻址，如何将域名和IP地址的映射进行解析就是DNS服务器的功能，即域名解析。

- 每台计算机都保存有一份DNS的缓存，域名解析首先会查询计算机本地缓存
- 每个局域网的网关都是一个默认的DNS服务器，域名解析的本地缓存查询失败后，会查询默认DNS服务器
- 如果该DNS服务器无法解析，会查询其他设置的DNS服务器
- 如果该DNS服务器无法解析，就会逐级向上，直到顶级根域名解析服务器，顶级根域名解析服务器记录全球所有的域名IP映射
- 然后会逐级向下响应，各级DNS服务器也会更新自己的缓存
- DNS服务其实就是这样一种层次化管理的分布式数据库







#### 全球域名系统

域名是对一个IP地址的语言记号。

通过数字标识地址是计算机逻辑，而对于人类而言，语言记号是更好的方式。于是通过提供域名解析（DNS）服务，来将IP地址和域名进行映射。

![img](https://gitee.com/masstsing/picgo-picserver/raw/master/23dc0a68d6016b71365e62879a3a6cbe.jpg)



### 端口

​		IP地址标识一台主机，但是并不能标识一个应用程序服务。一个端口，即一台主机上对外开放可供进行网络通信的槽位。

#### 众所周知端口 well known ports

​		从0-1023，这些端口由IANA分配和控制他们紧密绑定于一些服务。通常这些端口的通讯明确表明了某种服务的协议，如21端口为ftp服务端口，80端口为http端口。但这些端口都可以认为进行更改。

#### 注册端口 Registered Ports

​		从1024到49151,。这些不受IANA控制，但由IANA登记并提供使用情况清单。它们松散地绑定于一些服务。也就是说有许多服务在不同主机上绑定于这些端口，这些端口同样用于许多其他目的。例如 1433 Microsoft SQL服务端口。

#### 动态或私有端口 Dynamic or Private Ports

​		从49152到65525，IANA不管这些端口，实际上机器通常从1024起分配动态端口。但也有例外，如SUN的RPC端口从32768开始。



### 套接字对 - 四元组

```
（clientaddr:clientport, serveraddr: serverport)
```

​	![img](https://static001.geekbang.org/resource/image/54/2a/543b5488f9422558069df507cfaa462a.png)



### 交互模型 - c/s 模型



![img](https://gitee.com/masstsing/picgo-picserver/raw/master/78e415180d2946c418485d30f3f78f83.png)

​		服务器需要监听在一个众所周知的端口上，等待客户端发送请求。服务器同时为多个客户端提供服务。

​		客户端向服务器端的监听端口发起请求。

> 无论服务器还是客户端，程序运行的单位都是进程（process），而不是主机。



















































