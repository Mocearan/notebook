# video

​		视频是由一幅幅图像组成的。

---

​		连续的图象变化每秒超过24帧（Frame）画面以上时，根据视觉暂留原理，人眼无法辨别单幅的静态画面，看上去是平滑连续的视觉效果，这样连续的画面叫做视频。

​		所以视频是基于图像概念的。

## 视频概念

- 帧率：构成每秒视频的图片数

  - 25fps表示一秒有25张图片
  - 由于视觉图像在视网膜的暂时停留，一般图像帧率能达到24帧，我们就认为图像是连续动态的。
  - 电影帧率一般是24fps，电视剧是25fps，监控行业常用25fps，音视频通话常用15fps。
  - 电子设备还有一个刷新率，视频帧率小于设备刷新率则多次刷新显示同一帧数据，视频帧率大于设备刷新率则可能出现掉帧。
    - 对帧率要求很高的fps游戏要求更高的屏幕刷新率
    - 每秒30次的屏幕刷新率所产生的闪烁现象我们的眼睛仍然能够察觉从而产生疲劳
    - 每秒75次以上人眼就完全觉察不到
- 码率：构成每秒视频的数据量
  - 1Mbps表示一秒有1Mbit的数据量
  - 因为构成视频单元的图片有帧间编码和帧内编码，所以帧率和码率衡量的视频质量并不相同
  - 大多数情况下码率越高，分辨率越高，也就越清晰。
    - 但模糊的视频文件大小（码率）也可以很大
    - 分辨率小的视频文件可能也比分辨率大的视频文件清晰。
    - 对于同一个原始图像源的时候，同样的编码算法，则码率越高，图像的失真就会越小，视频画面就会越清晰。

- 分辨率：视频分辨率与图片的分辨率概念一致
  - 720P与720i
    - i 表示隔行扫描
      - 相邻两帧分别渲染奇、偶行
      - 理论上人眼是察觉不出来画面不连续，反而是由于视觉残留，能自动将两帧叠加在一起。

    - p 则表示逐行扫描
      - 每一线都同时表现在画面上，因此比隔行扫描电视更加的平滑。




​	分辨率、帧率和码率三者之间的关系，我们以不同的基准来看一下。

- 当我们以码率为中心时：

  > 如果码率为变量，那么帧率就会影响视频的体积，帧率越高，每秒钟经过的画面越多，编码器每秒编出的数据也就越大，那么视频体积也就越大。分辨率则影响图像大小，分辨率越高，像素越多，则图像越大；反之图像越小。
  > 而当码率不变时，分辨率与清晰度成反比关系：分辨率越高，需要的码率就会变高，但是此时码率不变，就会导致图像越不清晰。反之分辨率越低，图像越清晰，但是图像也会越小。

- 如果以分辨率为中心：

  > 当分辨率不变时，码率与清晰度成正比关系：码率越高，图像越清晰；反之码率越低，图像越不清晰。

- 所以，一个好的画质并不是盲选最高的分辨率就可以，而是需要平衡好分辨率、帧率以及码率，某一个值偏高都会让画质受收到影响。

  > ​		然而这就带来了一个问题，如果一个视频的分辨率达到 720p、1080p 甚至更高，同时完美平衡了码率、帧数，我们会发现，视频的体积会变得相当大，这让视频在网络传输中对网速的要求迅速提升，甚至不进行处理会出现无法正常播放的情况。



## 视频编码

### 原理

​		编码其实就是压缩，就是要去除冗余信息。

​		连续画面中大量信息是重复冗余的，在组织视频的时候，并不是将每张图片的全部数据都全部保留。视频通过帧间编码技术去除冗余信息进行数据量的压缩。

​		通常有2种方法：

- 压缩分辨率，去除重复多余的信息；
- 质量压缩，去掉一些人感知不敏感的信息。

​		相较于音频数据，视频数据有极强的相关性，也就是说有大量的冗余信息。视频的冗余信息：

1. 空间冗余，即相邻的像素往往很相似。
2. 时间冗余，即相邻的帧的内容往往很相似。
3. 视觉冗余，即人眼感知不敏感的信息。

​	

![image-20220821235406691](https://raw.githubusercontent.com/Mocearan/picgo-server/main/image-20220821235406691.png)

​		常见的编码技术流程：

- 帧内预测压缩： 利用图像空间相关性，去除空间冗余信息。
- 帧间预测压缩：一段连续视频帧无太大图像变化，帧间数据复用去除时域数据。
- 整数离散余弦变换：去除频域无关数据，即视觉冗余数据。
- 量化：
- CABAC压缩：真正的编码环节
  - 将帧内预测、帧间预测、DCT处理得到的数据，使用编码算法编码为最终的码流。



### 帧类型

​		经过压缩后的帧分为：I帧，P帧和B帧。

- I帧：关键帧，采用帧内压缩技术。
- P帧：向前参考帧，在压缩时，只参考前面已经处理的帧。采用帧间压缩技术。
- B帧：双向参考帧，在压缩时，它即参考前而的帧，又参考它后面的帧。采用帧间压缩技术。
- 两个I帧之间的一组帧

![在这里插入图片描述](https://img-blog.csdnimg.cn/img_convert/2d11ae3d85b2bd5b0bb18da7a68cad87.png#pic_center)



### GOP

​		GOP（Group Of Picture），表示视频中一个独立播放的图片组。两个I帧之间是一个图像序列，在一个图像序列中只有一个I帧且为首帧。

![在这里插入图片描述](https://img-blog.csdnimg.cn/img_convert/2d11ae3d85b2bd5b0bb18da7a68cad87.png#pic_center)

### PTS / DTS

​		由于B帧的引入，会导致一个现象，就是编码的帧顺序和播放的帧顺序会不一致,所以也衍生了两个时间戳，DTS（Decoding Time Stamp）和 PTS（Presentation Time Stamp）。顾名思义，前者是解码的时间，后者是显示的时间。



## 视频编码标准

![img](https://img-blog.csdn.net/20170710154519093)

> Mpeg1（用于VCD）、Mpeg2（用于DVD）、Mpeg4 AVC（现在流媒体使用最多的就是它了）

### profile

​		在视频编码标准中，尤其是 H.264 (也称为 AVC) 中，"profile" 指的是一组特定的编码特性和功能的集合，规定了编码器和解码器应该支持的功能和限制。不同的 profile 可以满足不同的应用需求，比如视频质量、复杂性和处理能力的不同。

​		video profile 是确保视频编码的一致性和兼容性的重要部分，允许开发者和用户选择适合其需求的编码特性。

#### Profile 的作用

- **兼容性**：不同的设备和平台可以根据支持的 profile 来决定能播放哪些视频内容。
- **性能优化**：通过选择合适的 profile，可以在提供所需视频质量的同时，优化编码器的性能和解码器的资源占用。
- **特性控制**：不同的 profile 定义了一系列特性的支持，例如色彩空间、帧率、码率等，允许内容创作者根据具体需求选择最合适的方案。

#### 常见的 H.264 Profiles

1. **Baseline Profile**：主要用于视频会议和流媒体，支持较低的延迟和复杂度，通常用于实时应用。
2. **Main Profile**：提供比 Baseline Profile 更高的压缩效率，适合于标准清晰度的电视广播和一些在线流媒体。
3. **High Profile**：用于高清晰度的视频内容，具有更高的压缩效率和更复杂的编码选项，是大多数蓝光光盘和高清电视节目使用的标准。
4. **High 10 Profile**：支持10位色深，适用于高动态范围和更高质量的色彩表示，通常用于专业视频制作。



## 固定码率和可变码率

​		输出视频文件的时候都会碰到一个选择即CBR与VBR。

- CBR（Constant Bit Rate）固定码率
  - 每一秒种采样的视频大小是固定的。
  - 在压缩输出的时候就把画一秒的画面都计算为固定的大小
    - 运算量小，编码时间短而且解码算法也简单，
    - 缺点是在画面剧烈运动的时候会由于码率不够而丢失部分画面信息
    - 从视觉上来画面波纹严重，图像不清晰。
- VBR（Variable Bit Rate）
  - 每一秒采样的视频大小是不固定。
  - 移动的画面所要消耗的存储量是大于静止的画面的
  - VBR有三个参数分别是MAX，Average和MIN，分别是指视频的最大码率，平均码率和最小码率。
  - 由于在压缩的时候我们要大概的知道成片的大小是多少这个时候我们可以用VBR的平均码率来计算出视频文件的大概大小是多少。
  - 采用VBR压缩输出视频的时候计算机会先进行一下逐帧的扫描把运动量大的画面码率调高，运动量小或是静止的画面码率调低并保证平均后的码率等于ARG值。

> 由于电脑存储文件是采用字节即Byte而在电路中实现传输的时候采取的是比特流即Bit，8个Bit组成一个Byte。所以我们以平均码率6Mbps来计算每一秒的画面就是6Mbps/8=750KB那么一小时的视频文件大小就是750KB*3600=2700MB即2.7GB，这就是一般的DVD视频文件一小时的大小。
>
> VBR的优点就体现出来了画面质量相对高，但是缺点也出来了运算量大压缩时间长，更严重的对解码算法的要求就复杂了很多相对的对解码器的CPU要求就也高了。这就是很多手机可以播出CBR的RM视频却播不了VBR的RMVB视频的原因，因为手机的CPU还没有足够的强，内存也不能运算如此复杂的解码算法。

