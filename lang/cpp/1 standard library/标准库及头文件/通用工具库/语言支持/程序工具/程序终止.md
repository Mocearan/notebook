# 程序终止

---

## ternimate status

​		**Normal termination** means the program has exited in an expected way. Note that the term `normal termination` does not imply anything about whether the program was successful (that’s what the `status code` is for). 

 		**Abnormal termination** means the program had some kind of unusual runtime error and the program couldn’t continue to run. 

## std::exit

​		`std::exit()` is a function that causes the program to terminate normally. 



​		`std::exit()` performs a number of cleanup function. First, objects with static storage duration are destroyed. Then some other miscellaneous file cleanup is done if any files were used. Finally, control is returned back to the OS, with the argument passed to `std::exit()` used as the `status code`.

​		Although `std::exit()` is called implicitly when function `main()` ends, `std::exit()` can also be called explicitly to halt the program before it would normally terminate. When `std::exit()` is called this way, you will need to include the `cstdlib` header.

```c++
#include <cstdlib> // for std::exit()
#include <iostream>

void cleanup()
{
    // code here to do any kind of cleanup required
    std::cout << "cleanup!\n";
}

int main()
{
    std::cout << 1 << '\n';
    cleanup();

    std::exit(0); // terminate and return status code 0 to operating system

    // The following statements never execute
    std::cout << 2 << '\n';

    return 0;
}
```

​		 the statements after the call to `std::exit()` never execute because the program has already terminated.

​		The `std::exit()` function does not clean up local variables in the current function or up the call stack.



## std::atexit

​		 allows you to specify a function that will automatically be called on program termination via `std:exit()`.

```c++
#include <cstdlib> // for std::exit()
#include <iostream>

void cleanup()
{
    // code here to do any kind of cleanup required
    std::cout << "cleanup!\n";
}

int main()
{
    // register cleanup() to be called automatically when std::exit() is called
    std::atexit(cleanup); // note: we use cleanup rather than cleanup() since we're not making a function call to cleanup() right now

    std::cout << 1 << '\n';

    std::exit(0); // terminate and return status code 0 to operating system

    // The following statements never execute
    std::cout << 2 << '\n';

    return 0;
}
```

-  `std::exit()` is called implicitly when `main()` terminates

  ​	 this will invoke any functions registered by `std::atexit()` if the program exits that way.

- the function being registered must take no parameters and have no return value.

- can register multiple cleanup functions using `std::atexit()`

  ​	they will be called in reverse order of registration (the last one registered will be called first).



## std::quick_exit / std::at_quick_exit

​		In multi-threaded programs, calling `std::exit()` can cause your program to crash (because the thread calling `std::exit()` will cleanup static objects that may still be accessed by other threads).

​		 For this reason, C++ has introduced another pair of functions that work similarly to `std::exit()` and `std::atexit()` called `std::quick_exit()` and `std::at_quick_exit()`. 

​		`std::quick_exit()` terminates the program normally, but does not clean up static objects, and may or may not do other types of cleanup. 

​		`std::at_quick_exit()` performs the same role as `std::atexit()` for programs terminated with `std::quick_exit()`.



std::abort 

​		The `std::abort()` function causes your program to terminate abnormally. 

> [Assert and static_assert](https://www.learncpp.com/cpp-tutorial/assert-and-static_assert/)) where `std::abort` is called implicitly.



## std::terminate

​		The `std::terminate()` function is typically used in conjunction with `exceptions` (we’ll cover exceptions in a later chapter).

​		Although `std::terminate` can be called explicitly, it is more often called implicitly when an exception isn’t handled (and in a few other exception-related cases).

​		By default, `std::terminate()` calls `std::abort()`.