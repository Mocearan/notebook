



# 对象的生存期

​		每个对象和引用都有生存期（lifetime），这是一项运行时性质。

---

​		每个对象或引用在程序执行时都存在一个时刻，开始其生存期，也都存在一个时刻，结束其生存期。

​		对象的生存期要么和它的存储空间的生存期相同，或者内嵌于其中。

>   内嵌其中：即对象的生存期可能是他的存储空间的生存期的一个子集。
>
>   ​	如该存储空间没有被释放，但在该存储地址上构造了新对象，使得旧对象生存期结束。

## 对象生存期的开始

-   将获得与其类型对应的正确对齐方式和大小的存储

-   完成其初始化（若存在）（包括不经由构造函数或经由**平凡默认构造函数**的默认初始化），除非：

    -   对象是联合体成员或其子对象，生存期的开始决定于联合体成员是否在联合体中初始化，或者联合体是否被激活

    -   若对象内嵌与联合体对象，则其生存期开始于**平凡特殊成员函数**赋值或构造含有它的联合体对象

    -   如果数组对象是通过``std::allocator::allocate`分配的，它的生命周期也可以开始。

        >   **平凡默认构造函数：**	
        >
        >   ​		不进行任何动作的构造函数，所有与C语言兼容的数据类型（POD类型）都是可平凡默认构造的。
        >
        >   ps：c++语言/基础语法/类/特殊成员函数/默认构造函数/平凡默认构造函数
        >
        >   **平凡特殊成员函数：**
        >
        >   ​		trivial special member function.
        >
        >   ​		即特殊成员函数的每个不执行任何特殊操作的版本。
        >
        >   ps：c++语言/基础语法/类/特殊成员函数/*/平凡成员函数



​		某些操作会在给定的存储区域中**隐式创建对象**，并开始其生存期，这些对象拥有**隐式生存期类型**。

## 对象生存期的结束

-   如果是非类类型，则在销毁该对象时结束（从20起，可能会过**伪析构函数**调用结束）

    >   **伪析构函数调用：**
    >
    >   ​		唯一作用在于计算点号或箭头前面的*后缀表达式*
    >
    >   ps: c++语言/基础语法/类/特殊成员函数/析构函数/伪析构函数调用
    >
    >   https://blog.csdn.net/weixin_30642267/article/details/97374403

-   如果是类类型，则是**析构函数**调用开始时

    >   **析构函数：**
    >
    >   ​		释放对象可能在其生存期间获得的资源。
    >
    >   ps: c++语言/基本语法/类/特殊成员函数/析构函数

-   如果对象占据的存储空间被释放，或者被不内嵌在该对象中的对象所重用。

>   





## 静态变量的生存期

- 所有静态变量（静态存储期）的生命周期一直驻留到进程退出为止
- 但是全局静态变量的创建时机与进程一致，分布在各个编译单元的全局静态静态变量作为程序执行的上下文信息而先于main的载入而创建。
- 局部静态变量，当程序流程第一次到达该处时才创建且无论流程经历多少次都只创建一次，并驻留到程序结束为止。
- 全局作用域下的变量，默认都是静态存储期的外部变量，加上static声明为静态存储期的内部变量。

## 引用的生存期

​	引用的生存期，从初始化完成之时开始，并与**标量对象**以相同的方式结束。

>   **NOTE：**
>
>   ​	被引用对象的生生存期可能在引用的生存期结束之前就结束，这会造成**悬垂引用**。
>
>   ​	非静态数据成员和基类子对象的生存期，按照**类初始化顺序**开始和结束。
>
>   **悬垂引用：**
>
>   ​		源对象生存期接受，但引用仍可继续访问，造成悬垂（danging)。
>
>   ps: c++语言/基础语法/声明/声明符/引用声明/悬垂引用
>
>   **类初始化顺序：**
>
>   ps：c++语言/基础语法/类/初始化顺序

## 隐式生存期类型

​		隐式生存期类型：

-   标量类型

-   数组类型

-   聚合类型

    ​	通过花括号初始化器列表初始化聚合体。

-   至少一个平凡的合格构造函数 或 一个平凡且未被删除的析构函数 的类类型

-   或以上类型的的**cv限定**版本

    ​	即**const和volatile**类型限定符，可出现于任何类型说明符（包括声明说明符序列）中，以指定被声明对象或被命名类型的常量性（constness）或易变性（volatile）。

​	若隐式创建的对象有不是隐式生存期类型的子对象，则其生存期不会隐式开始。

